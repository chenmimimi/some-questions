var startX = 0;
var translateX = 0;
var isMoving = false;
var isActive = false;

function touchStart(e) {
  // console.log(JSON.stringify(e));
  startX = e.touches[0].clientX;
  isMoving = true;

}

function touchMove(e, ownerInstance) {
  var instance = ownerInstance.selectComponent('.swipe-action-ctn');
  var moveX = 0;
  if(isMoving) {
    moveX = e.touches[0].clientX - startX + (isActive?-100:0);
    if(moveX < 0 && moveX > -100) {
      translateX = moveX;
    }else if(moveX <= -100){
      translateX = -100;
    }else{
      translateX = 0;
    }
    instance.getDataset();
    instance.setStyle({
      'transform': 'translate3d(' + translateX + 'px, 0px, 0px)'
    })
  }
}

function touchEnd(e, ownerInstance) {
  var instance = ownerInstance.selectComponent('.swipe-action-ctn');
  isMoving = false;
  if(translateX > -40){
    instance.setStyle({
      'transform': 'translate3d(0px, 0px, 0px)',
      'transition': '.3s all ease-in-out',
    });
    isActive = false;
  }else{
    translateX = -100;
    instance.setStyle({
      'transform': 'translate3d(-100px, 0px, 0px)',
      'transition': '.3s all ease-in-out',
    });
    isActive = true;
    return false;
  }
}

function onTap(e, ownerInstance) {
  var instance = ownerInstance.selectComponent('.swipe-action-ctn');
  if(isActive){
    translateX = 0;
    instance.setStyle({
      'transform': 'translate3d(0px, 0px, 0px)',
      'transition': '.3s all ease-in-out',
    });
    isActive = false;
  }else{
    ownerInstance.triggerEvent('onTap', { abc: 1234 }, {});
  }
}

module.exports = {
  touchStart: touchStart,
  touchMove: touchMove,
  touchEnd: touchEnd,
  onTap: onTap,
}
